<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tombstone Grand Hotel – Housekeeping Board</title>
  <style>
    :root {
      --accent: #005ea0;
      --text: #222;
      --bg: #fff;
      --border: #e5e7eb;
      --running: #22c55e;
      --idle: #9ca3af;
      --arrival: #fff7e6;
      --stayover: #ecfdf5;
      --departure: #fef2f2;
      --highlight: #e0f2fe;
    }
    html,body {
      margin:0;
      height:100%;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
    }
    header {
      background:var(--accent);
      color:#fff;
      padding:16px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    h1 {margin:0;font-size:1.5rem;}
    #clock {font-weight:600;}
    main {padding:20px;}
    .controls, .add-room {
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    input, select {
      padding:6px;
      border:1px solid var(--border);
      border-radius:4px;
      font-size:0.9rem;
    }
    .btn {
      background:var(--accent);
      color:#fff;
      border:none;
      padding:8px 14px;
      border-radius:6px;
      cursor:pointer;
      font-size:0.9rem;
    }
    .btn:hover {background:#00447d;}
    table {
      width:100%;
      border-collapse:collapse;
      font-size:0.95rem;
    }
    th,td {
      border:1px solid var(--border);
      padding:8px 6px;
      text-align:left;
    }
    th {background:#f3f4f6;}
    tr:nth-child(even){background:#fafafa;}
    .status-arrival {background:var(--arrival);}
    .status-stayover {background:var(--stayover);}
    .status-departure {background:var(--departure);}
    .highlighted {border-left:5px solid var(--accent); background:var(--highlight);}
    .timer.running {color:var(--running);font-weight:600;}
    .timer.idle {color:var(--idle);}
    .summary {
      margin-top:10px;
      font-weight:600;
      font-size:0.95rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Tombstone Grand Hotel – Housekeeping Board</h1>
    <div id="clock">--:--:--</div>
  </header>
  <main>
    <div class="add-room">
      <input type="text" id="roomNum" placeholder="Room #" size="5" />
      <select id="roomType">
        <option value="">Type</option>
        <option>RM2</option>
        <option>RM3</option>
        <option>AC1</option>
        <option>AC2</option>
        <option>AC3</option>
        <option>SU1</option>
      </select>
      <select id="guestStatus">
        <option value="">Guest Status</option>
        <option>Arrival</option>
        <option>Stayover</option>
        <option>Departure</option>
      </select>
      <select id="hkStatus">
        <option>Dirty</option>
        <option>In Progress</option>
        <option>Clean</option>
        <option>Inspected</option>
      </select>
      <select id="attendant">
        <option value="">Attendant</option>
        <option>Hilda</option>
        <option>Jonnah</option>
        <option>Kennedy</option>
        <option>Angie</option>
        <option>Mayte</option>
      </select>
      <button class="btn" id="addRoomBtn">+ Add Room</button>
    </div>

    <div class="controls">
      <button class="btn" id="exportBtn">Export CSV</button>
      <span id="viewLabel"></span>
    </div>

    <table id="roomsTable">
      <thead>
        <tr>
          <th>Room</th>
          <th>Type</th>
          <th>Guest Status</th>
          <th>HK Status</th>
          <th>Attendant</th>
          <th>Timer</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="summary" id="summaryTotals"></div>
  </main>

  <script>
  const tableBody = document.querySelector('#roomsTable tbody');
  const addRoomBtn = document.getElementById('addRoomBtn');
  const exportBtn = document.getElementById('exportBtn');
  const summaryTotals = document.getElementById('summaryTotals');
  const viewLabel = document.getElementById('viewLabel');

  let data = [];
  let timers = {};
  const attendantParam = new URLSearchParams(window.location.search).get('attendant');

  /* Clock */
  function updateClock(){
    const now=new Date();
    document.getElementById("clock").textContent = now.toLocaleTimeString();
  }
  setInterval(updateClock,1000);updateClock();

  /* Add Room */
  addRoomBtn.addEventListener('click', () => {
    const room = document.getElementById('roomNum').value.trim();
    const type = document.getElementById('roomType').value;
    const guestStatus = document.getElementById('guestStatus').value;
    const hkStatus = document.getElementById('hkStatus').value;
    const attendant = document.getElementById('attendant').value;
    if(!room) return alert('Enter room number');

    data.push({room, type, guestStatus, hkStatus, attendant});
    renderTable();
    document.querySelectorAll('.add-room input, .add-room select').forEach(e=>e.value="");
  });

  /* Render Table */
  function renderTable(){
    tableBody.innerHTML = "";
    let totals = {arrival:0, stay:0, depart:0};
    data.forEach((r,i)=>{
      const tr=document.createElement('tr');
      tr.dataset.index=i;
      if(/arrival/i.test(r.guestStatus)) tr.classList.add('status-arrival'), totals.arrival++;
      else if(/stay/i.test(r.guestStatus)) tr.classList.add('status-stayover'), totals.stay++;
      else if(/depart/i.test(r.guestStatus)) tr.classList.add('status-departure'), totals.depart++;

      if(attendantParam && r.attendant.toLowerCase()===attendantParam.toLowerCase())
        tr.classList.add('highlighted');

      tr.innerHTML = `
        <td>${r.room}</td>
        <td>${r.type}</td>
        <td>${r.guestStatus}</td>
        <td>
          <select class="hkStatus">
            <option ${r.hkStatus==='Dirty'?'selected':''}>Dirty</option>
            <option ${r.hkStatus==='In Progress'?'selected':''}>In Progress</option>
            <option ${r.hkStatus==='Clean'?'selected':''}>Clean</option>
            <option ${r.hkStatus==='Inspected'?'selected':''}>Inspected</option>
          </select>
        </td>
        <td>${r.attendant}</td>
        <td class="timer idle">00:00:00</td>`;
      tableBody.appendChild(tr);
    });

    summaryTotals.textContent = `Total: ${data.length} | Arrivals: ${totals.arrival} | Stayovers: ${totals.stay} | Departures: ${totals.depart}`;
    attachHandlers();
  }

  /* HK Status change + Timer */
  function attachHandlers(){
    document.querySelectorAll('.hkStatus').forEach(sel=>{
      sel.addEventListener('change',e=>{
        const tr=e.target.closest('tr');
        const idx=tr.dataset.index;
        const val=e.target.value;
        const timerEl=tr.querySelector('.timer');
        data[idx].hkStatus=val;
        if(val==='In Progress') startTimer(timerEl,idx);
        else if(['Clean','Inspected'].includes(val)) stopTimer(timerEl,idx);
      });
    });
  }

  function startTimer(el,idx){
    if(timers[idx]) return;
    const start=Date.now();
    el.classList.remove('idle'); el.classList.add('running');
    timers[idx]=setInterval(()=>{
      const diff=Date.now()-start;
      const h=String(Math.floor(diff/3600000)).padStart(2,'0');
      const m=String(Math.floor((diff%3600000)/60000)).padStart(2,'0');
      const s=String(Math.floor((diff%60000)/1000)).padStart(2,'0');
      el.textContent=`${h}:${m}:${s}`;
    },1000);
  }
  function stopTimer(el,idx){
    if(!timers[idx]) return;
    clearInterval(timers[idx]);
    timers[idx]=null;
    el.classList.remove('running'); el.classList.add('idle');
  }

  /* Export CSV */
  exportBtn.addEventListener('click',()=>{
    if(data.length===0) return alert("No data to export");
    let csv="Room,Type,Guest Status,HK Status,Attendant\n";
    data.forEach(r=>{
      csv+=`${r.room},${r.type},${r.guestStatus},${r.hkStatus},${r.attendant}\n`;
    });
    const blob=new Blob([csv],{type:"text/csv"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;a.download="housekeeping_log.csv";
    document.body.appendChild(a);a.click();a.remove();
  });

  /* Reset at 6 AM */
  function checkReset(){
    const now=new Date();
    const hr=now.getHours();
    const last=localStorage.getItem("lastReset");
    const today=now.toDateString();
    if(last!==today && hr>=6){
      localStorage.clear();
      localStorage.setItem("lastReset",today);
      data=[];timers={};
      tableBody.innerHTML="";
      summaryTotals.textContent="";
    }
  }
  setInterval(checkReset,60000);
  checkReset();

  /* Label view */
  if(attendantParam){
    const name=attendantParam.charAt(0).toUpperCase()+attendantParam.slice(1).toLowerCase();
    viewLabel.textContent=`Attendant View – ${name}`;
  } else {
    viewLabel.textContent="Manager View – All Rooms";
  }
  </script>
</body>
</html>
