<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tombstone Grand Hotel – Housekeeping System</title>
  <style>
    :root {
      --accent: #005ea0;
      --text: #222;
      --bg: #fff;
      --border: #e5e7eb;
      --running: #22c55e;
      --idle: #9ca3af;
      --arrival: #fff7e6;
      --stayover: #ecfdf5;
      --departure: #fef2f2;
    }
    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100%;
    }
    header {
      background: var(--accent);
      color: #fff;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    h1 {margin: 0; font-size: 1.5rem;}
    #clock {font-weight: 600;}
    main {padding: 20px;}

    /* Login */
    #loginScreen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(160deg, #f0f4f8, #dbeafe);
    }
    .login-box {
      background: #fff;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      width: 320px;
      text-align: center;
    }
    .login-box h2 {margin-bottom: 20px; color: var(--accent);}
    .login-box input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }
    .login-box button {
      width: 100%;
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }
    .login-box button:hover {background:#00447d;}
    .error {color: red; font-size: 0.9rem; margin-top: 8px;}
  </style>
</head>
<body>

  <!-- LOGIN SCREEN -->
  <div id="loginScreen">
    <div class="login-box">
      <h2>Tombstone Grand Hotel</h2>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button id="loginBtn">Login</button>
      <div class="error" id="loginError"></div>
    </div>
  </div>

  <!-- MAIN DASHBOARD -->
  <div id="dashboard" style="display:none;">
    <header>
      <h1>Housekeeping Dashboard</h1>
      <div id="clock">--:--:--</div>
    </header>
    <main>
      <div id="userRole"></div>
      <div id="controls"></div>
      <table id="roomTable" border="1" cellspacing="0" cellpadding="6" width="100%">
        <thead>
          <tr>
            <th>Room</th>
            <th>Type</th>
            <th>HK Status</th>
            <th>Occupancy</th>
            <th>Guest Status</th>
            <th>Check-In</th>
            <th>Check-Out</th>
            <th>Order/Reason</th>
            <th>Description</th>
            <th>Notes</th>
            <th>Timer</th>
          </tr>
        </thead>
        <tbody id="roomBody"></tbody>
      </table>
      <div id="summary"></div>
    </main>
  </div>

<script>
/* ====== LOGIN LOGIC ====== */
const credentials = {
  manager: "admin2025",
  hilda: "hk101",
  johana: "hk102",
  kennedy: "hk103",
  angie: "hk104",
  mayte: "hk105"
};
let currentUser = null;

document.getElementById("loginBtn").addEventListener("click", () => {
  const u = document.getElementById("username").value.trim().toLowerCase();
  const p = document.getElementById("password").value.trim();
  const err = document.getElementById("loginError");
  if(credentials[u] && credentials[u] === p){
    currentUser = u;
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("dashboard").style.display="block";
    document.getElementById("userRole").innerHTML = 
      `<h2>Welcome, ${u.charAt(0).toUpperCase()+u.slice(1)}</h2>`;
    initDashboard();
  } else {
    err.textContent = "Invalid username or password.";
  }
});

/* ===== CLOCK ===== */
function updateClock(){
  const now=new Date();
  const h=String(now.getHours()).padStart(2,"0");
  const m=String(now.getMinutes()).padStart(2,"0");
  const s=String(now.getSeconds()).padStart(2,"0");
  document.getElementById("clock").textContent=`${h}:${m}:${s}`;
}
setInterval(updateClock,1000); updateClock();

/* ===== Placeholder for next parts ===== */
function initDashboard(){
  // room data, timers, logic to come in Parts 2-4
}
</script>
/* ===== TABLE DISPLAY & LOGIC ===== */
function initDashboard() {
  const tbody = document.getElementById("roomBody");
  tbody.innerHTML = "";

  // auto-fill room data into table
  rooms.forEach((r, i) => {
    const tr = document.createElement("tr");

    // row color based on guest status
    let rowClass = "";
    if (/arrival/i.test(r.guestStatus)) rowClass = "status-arrival";
    else if (/stay/i.test(r.guestStatus)) rowClass = "status-stayover";
    else if (/depart/i.test(r.guestStatus)) rowClass = "status-departure";
    tr.className = rowClass;

    tr.innerHTML = `
      <td>${r.room}</td>
      <td>${r.type}</td>
      <td>
        <select class="hkStatus">
          <option ${r.hkStatus==="Dirty"?"selected":""}>Dirty</option>
          <option ${r.hkStatus==="In Progress"?"selected":""}>In Progress</option>
          <option ${r.hkStatus==="Clean"?"selected":""}>Clean</option>
          <option ${r.hkStatus==="Inspected"?"selected":""}>Inspected</option>
        </select>
      </td>
      <td>${r.occupancy || ""}</td>
      <td>${r.guestStatus || ""}</td>
      <td>${r.checkin || ""}</td>
      <td>${r.checkout || ""}</td>
      <td>${r.reason || ""}</td>
      <td>${r.description || ""}</td>
      <td contenteditable="true">${r.notes || ""}</td>
      <td class="timer idle">00:00:00</td>
    `;

    tbody.appendChild(tr);
  });

  attachHKListeners();
}

/* ===== HK STATUS CHANGE LISTENERS ===== */
function attachHKListeners() {
  document.querySelectorAll(".hkStatus").forEach((sel, idx) => {
    sel.addEventListener("change", e => {
      const val = e.target.value;
      const tr = e.target.closest("tr");
      const timerEl = tr.querySelector(".timer");
      if (val === "In Progress") startTimer(timerEl, idx);
      if (["Clean", "Inspected"].includes(val)) stopTimer(timerEl, idx);
    });
  });
}

/* ===== TIMER FUNCTIONS ===== */
let timers = {};

function startTimer(el, idx) {
  if (timers[idx]) return;
  const start = Date.now();
  el.classList.remove("idle");
  el.classList.add("running");
  timers[idx] = setInterval(() => {
    const diff = Date.now() - start;
    const h = String(Math.floor(diff / 3600000)).padStart(2, "0");
    const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, "0");
    const s = String(Math.floor((diff % 60000) / 1000)).padStart(2, "0");
    el.textContent = `${h}:${m}:${s}`;
  }, 1000);
}

function stopTimer(el, idx) {
  if (!timers[idx]) return;
  clearInterval(timers[idx]);
  timers[idx] = null;
  el.classList.remove("running");
  el.classList.add("idle");
}
/* ===== EXPORT TO CSV ===== */
function exportCSV() {
  let csv = "Room,Type,Housekeeping Status,Occupancy,Guest Status,Check-In,Check-Out,Reason,Description,Notes\n";
  document.querySelectorAll("#roomBody tr").forEach(row => {
    const cells = [...row.children].map(td => td.innerText.replace(/,/g,""));
    csv += cells.join(",") + "\n";
  });
  const blob = new Blob([csv], {type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "housekeeping_board.csv";
  a.click();
}

/* ===== DAILY RESET (6 AM) ===== */
function checkReset() {
  const last = localStorage.getItem("lastReset");
  const now = new Date();
  const today = now.toDateString();
  const hr = now.getHours();
  if (last !== today && hr >= 6) {
    localStorage.clear();
    localStorage.setItem("lastReset", today);
    console.log("✅ Daily reset complete");
    location.reload();
  }
}
setInterval(checkReset, 60000);
checkReset();

/* ===== SUMMARY BAR ===== */
function updateSummary() {
  const rows = document.querySelectorAll("#roomBody tr");
  let arrivals=0, stays=0, deps=0;
  rows.forEach(r=>{
    const s = r.children[4].innerText.toLowerCase();
    if (s.includes("arriv")) arrivals++;
    else if (s.includes("stay")) stays++;
    else if (s.includes("depart")) deps++;
  });
  document.getElementById("summary").innerText =
    `Total: ${rows.length} | Arrivals: ${arrivals} | Stayovers: ${stays} | Departures: ${deps}`;
}

/* ===== INIT ON LOAD ===== */
window.onload = ()=>{
  updateClock();
  setInterval(updateClock,1000);
  initDashboard();
  updateSummary();
};

/* ===== BASIC STYLING ===== */
</script>

<style>
body {
  background:#fff;
  color:#222;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif;
  margin:0;
}
header {
  background:#005ea0;
  color:#fff;
  padding:10px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1 {margin:0;font-size:1.4rem;}
#clock {font-weight:600;}
main {padding:15px;}
button,select {
  border:1px solid #ccc;
  border-radius:5px;
  padding:6px 10px;
  cursor:pointer;
}
button:hover {background:#005ea0;color:#fff;}
table {
  width:100%;
  border-collapse:collapse;
  font-size:0.95rem;
}
th,td {
  border:1px solid #e5e7eb;
  padding:8px;
}
th {background:#f3f4f6;}
.status-arrival {background:#fff7e6;}
.status-stayover {background:#ecfdf5;}
.status-departure {background:#fef2f2;}
.timer.running {color:#22c55e;font-weight:600;}
.timer.idle {color:#9ca3af;}
#summary {
  margin-top:10px;
  font-weight:600;
  padding:8px;
  background:#f9fafb;
  border-radius:6px;
  border:1px solid #eee;
}
</style>
</html>
